class Cart{constructor(t,a){this.source=t,this.container=a,this.countGoods=0,this.amount=0,this.cartItems=[],this._init()}_init(){if(localStorage.getItem("userCart")){this.cartItems=JSON.parse(localStorage.getItem("userCart"));for(let t of this.cartItems)this._renderItem(t);this.amount=JSON.parse(localStorage.getItem("amount")),this.countGoods=JSON.parse(localStorage.getItem("countGoods")),this._renderSum()}else fetch(this.source).then(t=>t.json()).then(t=>{for(let a of t.items)this.cartItems.push(a),this._renderItem(a);this.countGoods=t.countGoods,this.amount=t.amount,localStorage.setItem("userCart",JSON.stringify(this.cartItems)),localStorage.setItem("amount",JSON.stringify(this.amount)),localStorage.setItem("countGoods",JSON.stringify(this.countGoods)),this._renderSum()})}_renderItem(t){let a=$("<div/>",{class:"cart-drop-product","data-product":t.id_product});a.append($(`<img class="cart-drop-img" src="${t.product_img}" alt="img_product">`));let e=$("<div/>",{class:"cart-drop-details"});e.append($(`<a class="cart-drop-details-name" href="#">${t.product_name}</a>`)),e.append($(`<p class="cart-drop-details-comment">${t.product_rating}</p>`)),e.append($(`<span class="cart-drop-details-quantity">${t.quantity}</span>`)),e.append($('<span class="cart-drop-details-factor"> x </span>')),e.append($(`<span class="cart-drop-details-price">$${t.price.toFixed(2)}</span>`));let s=$('<button class="cart-drop-details-delBtn">&#10005;</button>');s.click(()=>{this._remove(t.id_product)}),a.append(e),a.append(s),a.appendTo(this.container)}_renderSum(){$(".header-cart-count_goods").text(`${this.countGoods}`),$(".cart-drop-total-value").text(`$${this.amount.toFixed(2)}`)}_updateCart(t){$(`div[data-product="${t.id_product}"]`).find(".cart-drop-details-quantity").text(t.quantity)}addProduct(t){let a=+$(t).data("id"),e=this.cartItems.find(t=>t.id_product===a);if(e)e.quantity++,this.countGoods++,this.amount+=e.price,this._updateCart(e);else{let a={id_product:+$(t).data("id"),product_img:$(t).data("img"),product_name:$(t).data("name"),product_rating:$(t).data("rating"),product_color:$(t).data("color"),product_size:$(t).data("size"),product_shipping:$(t).data("shipping"),price:+$(t).data("price"),quantity:1};this.cartItems.push(a),console.log(this.cartItems),this._renderItem(a),this.amount+=a.price,this.countGoods+=a.quantity}localStorage.setItem("userCart",JSON.stringify(this.cartItems)),localStorage.setItem("amount",JSON.stringify(this.amount)),localStorage.setItem("countGoods",JSON.stringify(this.countGoods)),this._renderSum()}_remove(t){let a=this.cartItems.find(a=>a.id_product===t);this.cartItems.splice(this.cartItems.indexOf(a),1),$(`div[data-product="${t}"]`).remove(),this.amount-=a.price*a.quantity,this.countGoods-=a.quantity,localStorage.setItem("userCart",JSON.stringify(this.cartItems)),localStorage.setItem("amount",JSON.stringify(this.amount)),localStorage.setItem("countGoods",JSON.stringify(this.countGoods)),this._renderSum()}}