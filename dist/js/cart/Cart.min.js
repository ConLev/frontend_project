class Cart{constructor(t,a){this.source=t,this.container=a,this.countGoods=0,this.amount=0,this.cartItems=[],this._init()}_init(){if(localStorage.getItem("userCart"))if("0"===localStorage.getItem("amount"))$(".shopping-cart_container").empty(),this._renderSum();else{this._render(),this.cartItems=JSON.parse(localStorage.getItem("userCart"));for(let t of this.cartItems)this._renderItem(t);this.amount=JSON.parse(localStorage.getItem("amount")),this.countGoods=JSON.parse(localStorage.getItem("countGoods")),this._renderSum()}else this._render(),fetch(this.source).then(t=>t.json()).then(t=>{for(let a of t.items)this.cartItems.push(a),this._renderItem(a);this.countGoods=t.countGoods,this.amount=t.amount,localStorage.setItem("userCart",JSON.stringify(this.cartItems)),localStorage.setItem("amount",JSON.stringify(this.amount)),localStorage.setItem("countGoods",JSON.stringify(this.countGoods)),this._renderSum()})}_render(){let t=$("<div/>",{class:"products-box"}),a=$("<div/>",{class:"products-box-header"});a.append($("<span>Product Details</span>")),a.append($('<span class="unite-price-header">unite Price</span>')),a.append($('<span class="quantity-header">Quantity</span>')),a.append($('<span class="shipping-header">shipping</span>')),a.append($('<span class="subtotal-header">Subtotal</span>')),a.append($('<span class="action-header">ACTION</span>'));let e=$("<div/>",{class:"shopping-cart-button container"}),s=$('<button class="shopping-cart-button_clear">CLEAR SHOPPING CART</button>');s.click(()=>{this.cartItems=[],$(".header-cart-count_goods").text("0"),$(".shopping-cart_container").empty(),localStorage.setItem("userCart",JSON.stringify(this.cartItems)),localStorage.setItem("amount","0"),localStorage.setItem("countGoods","0")}),e.append(s),e.append($('<button class="shopping-cart-button_continue">CONTINUE SHOPPING</button>')),a.appendTo(t),t.appendTo($(this.container)),e.appendTo($(this.container))}_renderItem(t){let a=$("<div/>",{class:"product-box-details","data-product":t.id_product});a.append($(`<img src="${t.product_img}" class="product-box-img" alt="product_photo">`));let e=$("<div/>",{class:"product-details-box_parameter"});e.append($(`<a class="product-details-link" href="#">${t.product_name}</a>`));let s=$("<div/>",{class:"box-details-comment"});s.append($(`<span class="product-details-comment">${t.product_rating}</span>`)),e.append(s);let o=$("<div/>",{class:"product-details-color"});o.append($('<span class="product-details-parameter">Color:</span>')),o.append($(`<span class="product-details-value">${t.product_color}</span>`)),e.append(o);let n=$("<div/>",{class:"product-details-size"});n.append($('<span class="product-details-parameter">Size:</span>')),n.append($(`<span class="product-details-value">${t.product_size}</span>`)),e.append(n),a.append(e);let r=$("<div/>",{class:"cart-product-price"});r.append($(`<span class="cart-product-value_text">$${t.price}</span>`)),a.append(r);let p=$("<label/>",{class:"cart-product-quantity"}),i=$('<input class="cart-quantity-value" type="number" min="1"</input>');i.val(+t.quantity),i.on("keydown paste",t=>{t.preventDefault()}),i.click(()=>{this._updateQuantity(t.id_product,i.val())}),p.append(i),a.append(p);let c=$("<div/>",{class:"cart-product-shipping"});c.append($(`<span class="cart-product-value_text">${t.product_shipping}</span>`)),a.append(c);let d=$("<div/>",{class:"cart-product-subtotal"});d.append($(`<span class="cart-product-subtotal_value">$${t.price*t.quantity}</span>`)),a.append(d);let u=$("<div/>",{class:"cart-product-action"}),l=$('<button class="cart-product-remBtn">&#10005;</button>');l.click(()=>{this._remove(t.id_product)}),u.append(l),a.append(u),a.appendTo($(".products-box"))}_renderSum(){$(".sub-total-value").text(`$${this.amount}`),$(".grand-total-value").text(`$${this.amount}`),$(".header-cart-count_goods").text(`${this.countGoods}`)}_updateCart(t){$(`div[data-product="${t.id_product}"]`).find(".cart-product-subtotal_value").text(`$${t.price*t.quantity}`)}_updateQuantity(t,a){let e=this.cartItems.find(a=>a.id_product===t);e.quantity<a?(e.quantity=a,this.countGoods++,this.amount+=e.price,this._updateCart(e)):e.quantity>a&&(e.quantity=a,this.countGoods--,this.amount-=e.price,this._updateCart(e)),localStorage.setItem("userCart",JSON.stringify(this.cartItems)),localStorage.setItem("amount",JSON.stringify(this.amount)),localStorage.setItem("countGoods",JSON.stringify(this.countGoods)),this._renderSum()}_remove(t){let a=this.cartItems.find(a=>a.id_product===t);this.cartItems.splice(this.cartItems.indexOf(a),1),$(`div[data-product="${t}"]`).remove(),this.amount-=a.price*a.quantity,this.countGoods-=a.quantity,localStorage.setItem("userCart",JSON.stringify(this.cartItems)),localStorage.setItem("amount",JSON.stringify(this.amount)),localStorage.setItem("countGoods",JSON.stringify(this.countGoods)),this._renderSum()}}